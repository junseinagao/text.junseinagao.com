---
import { ClientRouter } from "astro:transitions";
import "../styles/global.css";
import "../styles/markdown.css";
---

<!doctype html>
<html lang="ja" prefix="og: https://ogp.me/ns#">
  <head>
    <slot name="head" />
    <ClientRouter />
  </head>
  <body class="bg-brand-base">
    <header
      id="js-global-header"
      class="sticky top-0 md:h-[100px] flex items-center z-50 bg-brand-base-accent border-b border-brand-sub shadow-[0_4px_12px_rgba(45,54,58,0.08),0_2px_4px_rgba(113,135,145,0.06)]"
    >
      <div
        class="w-full h-full flex justify-between items-center px-2 md:pl-0 md:pr-8 md:pb-2"
      >
        <a href="/" class="shrink-0 h-full flex items-center">
          <!-- Mobile Logo -->
          <img
            src="/images/return-j-only-typography-title.svg"
            alt="長尾ソフトウェア開発事務所「Return J」"
            class="h-12 md:hidden"
          />
          <!-- Desktop Logo -->
          <img
            src="/images/return-j-english-with-ja-title.svg"
            alt="長尾ソフトウェア開発事務所「Return J」"
            class="hidden md:block h-full object-contain transition-all duration-300 ease-in-out"
          />
        </a>

        <!-- Navigation (Right) -->
        <nav class="self-end md:pb-1">
          <ul
            class="flex gap-x-4 md:gap-x-8 text-lg md:text-2xl list-none text-brand-text"
          >
            <li>
              <a href="/" class="link-hover">All Articles</a>
            </li>
            <li>
              <a href="/me" class="link-hover">About</a>
            </li>
          </ul>
        </nav>
      </div>
    </header>

    <main
      class="container mx-auto flex flex-col items-center py-10 px-2 md:px-4"
    >
      <slot />
    </main>
    <footer
      class="flex items-center justify-center bg-brand-base-accent py-4 flex-col"
    >
      <a href="/me#business-profile-section">Contact me</a>
      <span class="text-brand-text"
        >© 2022-2025 Junsei Nagao. All rights reserved.</span
      >
    </footer>

    <script>
      function handleScroll() {
        const header = document.getElementById("js-global-header");
        if (!header) return;

        const currentScroll = window.scrollY;
        const startFade = 100; // フェード開始位置
        const endFade = 200; // フェード終了位置

        if (currentScroll <= startFade) {
          // 完全表示
          header.style.opacity = "1";
          header.style.transform = "translateY(0)";
          header.style.pointerEvents = "auto";
        } else if (currentScroll >= endFade) {
          // 完全非表示
          header.style.opacity = "0";
          header.style.transform = "translateY(-100%)";
          header.style.pointerEvents = "none";
        } else {
          // 段階的に変化
          const progress = (currentScroll - startFade) / (endFade - startFade);
          header.style.opacity = String(1 - progress);
          header.style.transform = `translateY(-${progress * 100}%)`;
          header.style.pointerEvents = progress > 0.5 ? "none" : "auto";
        }
      }

      let ticking = false;
      function onScroll() {
        if (!ticking) {
          window.requestAnimationFrame(() => {
            handleScroll();
            ticking = false;
          });
          ticking = true;
        }
      }

      // 初回実行
      handleScroll();
      window.addEventListener("scroll", onScroll, { passive: true });

      // ClientRouter対応
      document.addEventListener("astro:page-load", () => {
        handleScroll();
      });
    </script>
  </body>
</html>
